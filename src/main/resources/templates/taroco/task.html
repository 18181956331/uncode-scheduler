<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Taroco Scheduler Dashbord</title>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
    <link rel="stylesheet" th:href="@{/taroco/css/bootstrap.min.css}" />
    <link rel="stylesheet" th:href="@{/taroco/plugins/bootstrap-table/bootstrap-table.min.css}" />
    <script type="text/javascript" th:src="@{/taroco/js/jquery.min.js}"></script>
    <script type="text/javascript" th:src="@{/taroco/js/bootstrap.min.js}"></script>
    <script type="text/javascript" th:src="@{/taroco/plugins/bootstrap-table/bootstrap-table.min.js}"></script>
    <script type="text/javascript" th:src="@{/taroco/plugins/bootstrap-table/bootstrap-table-zh-CN.min.js}"></script>

    <style>
        .op-btn {
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <h1>Taroco Scheduler Dashbord</h1>
        <p>集群节点</p>
        <table id="server">
            <thead>
                <tr>
                    <th data-field="index">序号</th>
                    <th data-field="name">名称</th>
                    <th data-field="isLeader">调度节点</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="item, status:${serverList}">
                    <td th:text="${status.index}"></td>
                    <td th:text="${item.name}"></td>
                    <td th:text="${item.isLeader}"></td>
                </tr>
            </tbody>
        </table>
        <p></p>
        <p>集群任务</p>
        <table id="task">
            <thead>
            <tr>
                <th data-field="index">序号</th>
                <th data-field="targetBean">目标Bean</th>
                <th data-field="targetMethod">目标方法</th>
                <th data-field="cronExpression">cron表达式</th>
                <th data-field="period">周期（毫秒）</th>
                <th data-field="params">参数</th>
                <th data-field="type">任务类型</th>
                <th data-field="runTimes">执行次数</th>
                <th data-field="startTime">开始时间</th>
                <th data-field="lastRunningTime">最后执行时间</th>
                <th data-field="status">状态</th>
                <th data-field="_operate">操作</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="item, status:${taskList}">
                <td th:text="${status.index}"></td>
                <td th:text="${item.targetBean}"></td>
                <td th:text="${item.targetMethod}"></td>
                <td th:text="${item.cronExpression}"></td>
                <td th:text="${item.period}"></td>
                <td th:text="${item.params}"></td>
                <td th:text="${item.type}"></td>
                <td th:text="${item.runTimes}"></td>
                <td th:text="${item.startTime}"></td>
                <td th:text="${item.lastRunningTime}"></td>
                <td>
                    <span th:if="${item.status == 'running'}" class="label label-success">运行中</span>
                    <span th:if="${item.status == 'stop'}" class="label label-warning">已暂停</span>
                </td>
                <td>
                    <span th:if="${item.status == 'running'}" name="stop" th:data="@{/taroco/scheduler/task/{key}/stop(key=${item.key})}" class="glyphicon glyphicon-stop op-btn" title="暂停" style="color: #eea236"></span>
                    <span th:if="${item.status == 'stop'}" name="running" th:data="@{/taroco/scheduler/task/{key}/running(key=${item.key})}" class="glyphicon glyphicon-play op-btn" title="启动" style="color: green"></span>
                    <span name="delete" th:data="@{/taroco/scheduler/task/{key}(key=${item.key})}" class="glyphicon glyphicon-trash op-btn" style="color: red" title="删除"></span>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <script>
        $(function () {
            $('#server').bootstrapTable();
            $('#task').bootstrapTable();
            ajaxClick('delete', 'DELETE');
            ajaxClick('stop', 'PUT');
            ajaxClick('running', 'PUT');
        })

        /**
         * 绑定异步方法提交事件
         *
         * @param name 属性名称
         * @param type 请求方法类型
         */
        function ajaxClick(name,type){
            $("span[name='"+name+"']").click(function () {
                $.ajax({
                    type: type,
                    url: $(this).attr("data"),
                    success:function (data) {
                        if(!data){
                            window.location.reload();
                        }
                    }
                })
            })
        }
    </script>
</body>

</html>
